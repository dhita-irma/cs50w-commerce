{% extends 'auctions/layout-listing.html' %}
{% load crispy_forms_tags %}

{% block body %}
    <h1>{{ listing.title }}</h1>
    <small>By {{ listing.seller }} on {{ listing.created_date }}</small>
    <p>{{ listing.description }}</p>
    <p>Price started: ${{ listing.start_price }}</p>

    <strong>Current bid: ${{ listing.get_current_bid }}</strong>

    <!-- Bid Form -->
    <form action="{% url 'listing-bid' listing.id %}" method="POST">
        {% csrf_token %}
        {% crispy bid-form %}
    </form>

    <!-- Watchlist -->
    {% if not is_watchlist %}
        <br>
        <a href="{% url 'watchlist-add' listing.id %}">Add to Watchlist</a>
        <br>
    {% else %}
        <br>
        <a href="{% url 'watchlist-remove' listing.id %}">Remove from Watchlist</a>
        <br>
    {% endif %}
        
        <hr>
    <!-- Comment Section -->
    <h2>Comments</h2>
    <br>
    {% if not listing.comments.all %}
    No comments yet... <a href="#">Add one</a>
    {% else %}
    {% for comment in  listing.comments.all %}
    <strong>{{ comment.user }} - 
        {{ comment.posted_date }}
    </strong>
    <br>
    {{ comment.body }}
    <br><br>
    <hr>
    {% endfor %}
    {% endif %}

    <!-- Comment Form -->
    <form action="{% url 'listing-comment' listing.id %}" method="POST">
        {% csrf_token %}
        {% crispy comment-form %}
    </form>
    <br><br>
{% endblock body %}
